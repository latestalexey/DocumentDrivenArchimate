<!DOCTYPE html>
<html ng-app="app">
<head>
  <meta charset="utf-8">
  <title>d3js_archimate</title>
  <link rel="stylesheet" href="app.css">



  <script src="http://localhost/DocumentDrivenArchimate/bower_components/webcomponentsjs/webcomponents-lite.min.js"></script>
  <link rel="import" href="http://localhost/DocumentDrivenArchimate/bower_components/polymer/polymer.html" />

  <link rel="import" href="http://localhost/DocumentDrivenArchimate/bower_components/paper-dialog/paper-dialog.html" />
  <link rel="import" href="http://localhost/DocumentDrivenArchimate/bower_components/paper-button/paper-button.html" />
  <!-- icons -->
  <link rel="import" href="http://localhost/DocumentDrivenArchimate/bower_components/iron-icons/iron-icons.html">
  <!--<link rel="import" href="http://localhost/DocumentDrivenArchimate/bower_components/iron-icons/maps-icons.html">
  <link rel="import" href="http://localhost/DocumentDrivenArchimate/bower_components/iron-iconset-svg/iron-iconset-svg.html">-->
  <link rel="import" href="http://localhost/DocumentDrivenArchimate/bower_components/iron-pages/iron-pages.html" />

  <link rel="import" href="http://localhost/DocumentDrivenArchimate/bower_components/paper-toast/paper-toast.html" />

  <link rel="import" href="http://localhost/DocumentDrivenArchimate/bower_components/iron-flex-layout/classes/iron-flex-layout.html" />

  <link rel="import" href="http://localhost/DocumentDrivenArchimate/bower_components/paper-toolbar/paper-toolbar.html" />
  <link rel="import" href="http://localhost/DocumentDrivenArchimate/bower_components/paper-tabs/paper-tabs.html" />
  <link rel="import" href="http://localhost/DocumentDrivenArchimate/bower_components/paper-menu/paper-menu.html" />
  <link rel="import" href="http://localhost/DocumentDrivenArchimate/bower_components/paper-menu-button/paper-menu-button.html" />
  <link rel="import" href="http://localhost/DocumentDrivenArchimate/bower_components/paper-icon-button/paper-icon-button.html" />
  <link rel="import" href="http://localhost/DocumentDrivenArchimate/bower_components/paper-listbox/paper-listbox.html" />
  <link rel="import" href="http://localhost/DocumentDrivenArchimate/bower_components/paper-item/paper-item.html" />
  <link rel="import" href="http://localhost/DocumentDrivenArchimate/bower_components/paper-input/paper-input.html" />



  <link rel="import" href="http://localhost/DocumentDrivenArchimate/theme/classical/classical.html" />

  <link rel="import" href="http://localhost/DocumentDrivenArchimate/lib/customelements.html" />

  <!-- use paper-toast to indicate that saves wont be saved -->
  <script src="lib/angular.min.js"></script>
  <script src="lib/d3.v3.min.js"></script>
  <script src="lib/jquery-2.1.4.min.js"></script>
  <script src="lib/api-built.js"></script>

  <!-- main engine -->
  <script src="resources/archimate_configuration.js"></script>
  <script src="documentmodengine.js"></script>

  <script>
  //prepare('http://localhost/Archisurance.xml',"de");
  //prepare('http://192.168.192.48/Reference%20Model.xml','en');

  angular.module('app', [])
  .controller('createTabs', ['$scope', function createTabs($scope) {
    $scope.tabs = [{id:"div0"},{id:"div1"}];
  }])
  .controller('createPages', ['$scope', function createPages($scope) {
    $scope.pages = [];
  }]);


  </script>


</head>

<body ng-model="selected" onload="">
<paper-toast text="Warning! You have not checked out the Model. Changes won't be saved." opened></paper-toast>
<script>
function addmodelreference(){

  window.links[mr.label].push({
    label: document.querySelector("#linkname").value,
    link: document.querySelector("#linkactual").value,
    disabled: false
  })
  var event = new Event('LinkAdded');
  document.dispatchEvent(event);
}
</script>
<paper-dialog id="linkdialog" style="width:50%" >
 <h2>Add Link</h2>
  <paper-dialog-scrollable>
    <paper-input id="linkname" label="Link name" style="padding:20px" value="{{value}}"></paper-input>
    <paper-input id="linkactual" label="Link" style="padding:20px" value="{{value}}"></paper-input>
  </paper-dialog-scrollable>
  <div class="buttons">
    <paper-button dialog-dismiss >Cancel</paper-button>
    <paper-button dialog-confirm onclick="addmodelreference()">Accept</paper-button>
  </div>
</paper-dialog>

<!--
<div id="drop_zone">Drop files here</div>
<output id="list"></output>

<script>
  function handleFileSelect(evt) {
    evt.stopPropagation();
    evt.preventDefault();

    var files = evt.dataTransfer.files; // FileList object.

    // files is a FileList of File objects. List some properties.
    var output = [];
    for (var i = 0, f; f = files[i]; i++) {
      output.push('<li><strong>', escape(f.name), '</strong> (', f.type || 'n/a', ') - ',
                  f.size, ' bytes, last modified: ',
                  f.lastModifiedDate.toLocaleDateString(), '</li>');
    }
    document.getElementById('list').innerHTML = '<ul>' + output.join('') + '</ul>';
  }

  function handleDragOver(evt) {
    evt.stopPropagation();
    evt.preventDefault();
    evt.dataTransfer.dropEffect = 'copy'; // Explicitly show this is a copy.
  }

  // Setup the dnd listeners.
  var dropZone = document.getElementById('drop_zone');
  dropZone.addEventListener('dragover', handleDragOver, false);
  dropZone.addEventListener('drop', handleFileSelect, false);
</script>
-->
<dom-module id="model-selection">
  <template>
    <paper-dialog id="dialog" style="width:70%;height:70%">
      <paper-icon-button icon="arrow-back" title="backwards" on-click="back"></paper-icon-button>
      <paper-listbox id="list">
        <template is="dom-repeat" items="[[current]]">
          <div class="layout horizontal">
            <div class="flex">
              <paper-item>[[item.name]]</paper-item>
            </div>
          </div>
        </template>
      </paper-listbox>
    </paper-dialog>
  </template>
  <script>
    Polymer({
      is: 'model-selection',
      properties: {
        structure: Object,
        current: Array,
        navigation: Array,
        model:String
      },
      listeners: {
        'iron-select': 'respondToSelection'
      },
      ready:function(){
        if(this.structure){
          this.navigation = [];
          this.setItems();
        }else{
          var context = this;
          setTimeout(function(){context.ready()},100);
        }

      },
      back:function(e){
        this.navigation.splice(this.navigation.length-1,1);
        this.setItems(e);
      },
      setItems:function(e){
        this.current = this.structure.content;
        for(var i = 0;i < this.navigation.length;i++){
          if(this.current){
            var navigated = false;
            for(var j = 0;j < this.current.length && !navigated;j++){
              if(this.current[j].name == this.navigation[i]){
                  navigated = true;
                  if(this.current[j].get && !(this.current[j].content && this.current[j].content.length > 0)){
                    this.model = this.current[j].get;
                    this.close();
                    this.navigation.splice(this.navigation.length-1,1);
                    this.fire("modelselected",{"model":this.model});
                  }else{
                    this.current = (this.current[j].content);
                    this.$.list.select(-1)
                  }
                }
            }
          }
        }
      },
      open:function(e){
        this.$.dialog.open();
      },
      close:function(e){
        this.$.dialog.close();
      },
      respondToSelection:function(e){
        var lastitem = "";
        if(this.navigation.length>0){
          lastitem = this.navigation[this.navigation.length-1]
        }
        if(lastitem != e.detail.item.outerText){
            this.navigation.push(e.detail.item.outerText);

        }
        this.setItems(e);

      }
    });
  </script>
</dom-module>

<script type="text/javascript" src="repository/mockup.json"></script>
<model-selection id="ms"></model-selection>
<script>
  document.querySelector("#ms").structure = {};
  document.querySelector("#ms").structure = mockup;
  document.querySelector("#ms").addEventListener("modelselected",function(e){
    console.log(ms.model);
    prepare(ms.model,'en');
  },false);
  document.querySelector("#ms").open();
</script>

<model-menu id="menu"></model-menu>
<model-zoom></model-zoom>

<model-references id="mr">

</model-references>

</body>


</html>
